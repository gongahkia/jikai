# jikai — audit-driven improvement tasks
# Priority (B) = audit-suggested. Ordered by impact, grouped by concern.






## API robustness

[ ] batch item validation: in api/main.py batch_generate, validate each BatchGenerateConfig.topic against available topics before processing — return 400 with specific errors instead of 500 during generation +stability
[ ] export endpoint file cleanup: in api/main.py export_generation, use tempfile.NamedTemporaryFile(delete=False) and register a background task to delete the temp file after response is sent — prevents temp file accumulation +stability
[ ] export endpoint history bounds: in api/main.py export_generation, return 400 if format is not "docx" or "pdf" (already done) AND validate history_id is a non-negative integer — add explicit type validation +stability

## code quality

[ ] normalize topic keys: add a helper function normalize_topic(topic: str) -> str that does topic.lower().replace("_", " ").strip() — use it consistently in validation_service topic lookups, template case loading, and history filtering to eliminate the underscore/space mismatch bug +refactor
[ ] extract generation config dataclass: in rich_app.py, create a GenerationConfig dataclass (topic, provider, model, temperature, complexity, parties, method, red_herrings) to replace the 8-parameter _do_generate signature and the scattered dict construction for history/state +refactor
